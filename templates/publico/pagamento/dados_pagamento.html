<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dados de Pagamento - OBRATTO Fornecedor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .navbar {
            background-color: #007bff;
            padding: 1rem 2rem;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .navbar h1 {
            font-size: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 1rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-links a:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .card-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .card-header h2 {
            margin: 0;
            font-size: 2rem;
        }
        
        .card-header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
        }
        
        .card-body {
            padding: 2rem;
        }
        
        .plan-summary {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .plan-summary h3 {
            color: #0056b3;
            margin-bottom: 1rem;
        }
        
        .summary-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }
        
        .summary-detail:last-child {
            margin-bottom: 0;
            font-weight: bold;
            border-top: 1px solid #b8daff;
            padding-top: 0.75rem;
            margin-top: 0.75rem;
            font-size: 1.1rem;
        }
        
        .payment-form {
            display: grid;
            gap: 1.5rem;
        }
        
        .form-section {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .form-section h4 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group:last-child {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
        }
        
        .required {
            color: #dc3545;
        }
        
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .payment-method {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .payment-method:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .payment-method.selected {
            border-color: #007bff;
            background-color: #e7f3ff;
        }
        
        .payment-method input[type="radio"] {
            display: none;
        }
        
        .payment-method .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
        }
        
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .security-info {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1.5rem;
            text-align: center;
        }
        
        .security-info p {
            color: #155724;
            margin: 0;
            font-size: 0.9rem;
        }
        
        /* Estilos para cart√µes salvos */
        .saved-cards {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .card-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: white;
        }
        
        .card-option:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .card-option input[type="radio"] {
            margin-right: 1rem;
            width: auto;
        }
        
        .card-option input[type="radio"]:checked + .card-info {
            color: #007bff;
        }
        
        .card-option input[type="radio"]:checked {
            border-color: #007bff;
        }
        
        .card-info {
            flex: 1;
        }
        
        .card-number {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.25rem;
            font-family: 'Courier New', monospace;
        }
        
        .card-name {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .card-details {
            color: #6c757d;
            font-size: 0.8rem;
        }
        
        .principal-badge {
            background-color: #ffc107;
            color: #212529;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .manage-cards {
            text-align: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
        }
        
        .btn-link {
            color: #007bff;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .btn-link:hover {
            text-decoration: underline;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 1rem;
                padding: 0 0.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .summary-detail {
                flex-direction: column;
                gap: 0.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>üè¢ OBRATTO - Dados de Pagamento</h1>
        <div class="nav-links">
            <a href="/fornecedor/planos/listar">üí≥ Planos</a>
            <a href="/fornecedor/planos/meu_plano">üë§ Meu Plano</a>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2>üí≥ Finalizar Pagamento</h2>
                <p>Preencha os dados para completar sua {{ tipo_operacao or 'assinatura' }}</p>
            </div>
            
            <div class="card-body">
                {% if mensagem %}
                    <div class="alert alert-error">
                        {{ mensagem }}
                    </div>
                {% endif %}

                {% if plano %}
                    <div class="plan-summary">
                        <h3>üìã Resumo do Pedido</h3>
                        <div class="summary-detail">
                            <span><strong>Plano:</strong></span>
                            <span>{{ plano.nome_plano }}</span>
                        </div>
                        <div class="summary-detail">
                            <span><strong>Tipo:</strong></span>
                            <span>{{ plano.tipo_plano.title() }}</span>
                        </div>
                        <div class="summary-detail">
                            <span><strong>Limite de Servi√ßos:</strong></span>
                            <span>
                                {% if plano.limite_servico == 999 %}
                                    Ilimitado
                                {% else %}
                                    {{ plano.limite_servico }} por m√™s
                                {% endif %}
                            </span>
                        </div>
                        <div class="summary-detail">
                            <span><strong>Opera√ß√£o:</strong></span>
                            <span>{{ tipo_operacao or 'Nova Assinatura' }}</span>
                        </div>
                        <div class="summary-detail">
                            <span><strong>Total a Pagar:</strong></span>
                            <span>R$ {{ "%.2f"|format(plano.valor_mensal) }}</span>
                        </div>
                    </div>

                    <form method="post" action="/fornecedor/planos/processar_pagamento" class="payment-form">
                        <input type="hidden" name="plano_id" value="{{ plano.id_plano }}">
                        <input type="hidden" name="id_fornecedor" value="{{ id_fornecedor }}">
                        <input type="hidden" name="tipo_operacao" value="{{ tipo_operacao }}">
                        <input type="hidden" name="valor" value="{{ plano.valor_mensal }}">
                        
                        <div class="form-section">
                            <h4>üë§ Dados Pessoais</h4>
                            <div class="form-group">
                                <label for="nome_completo">Nome Completo <span class="required">*</span></label>
                                <input type="text" id="nome_completo" name="nome_completo" required 
                                       placeholder="Digite seu nome completo">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cpf">CPF <span class="required">*</span></label>
                                    <input type="text" id="cpf" name="cpf" required 
                                           placeholder="000.000.000-00" maxlength="14">
                                </div>
                                <div class="form-group">
                                    <label for="telefone">Telefone <span class="required">*</span></label>
                                    <input type="text" id="telefone" name="telefone" required 
                                           placeholder="(11) 99999-9999">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email">E-mail <span class="required">*</span></label>
                                <input type="email" id="email" name="email" required 
                                       placeholder="seu@email.com">
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>üí≥ M√©todo de Pagamento</h4>
                            <div class="payment-methods">
                                <label class="payment-method" for="cartao">
                                    <input type="radio" id="cartao" name="metodo_pagamento" value="cartao" checked>
                                    <div class="icon">üí≥</div>
                                    <div>Cart√£o de Cr√©dito</div>
                                </label>
                                <label class="payment-method" for="pix">
                                    <input type="radio" id="pix" name="metodo_pagamento" value="pix">
                                    <div class="icon">üì±</div>
                                    <div>PIX</div>
                                </label>
                                <label class="payment-method" for="boleto">
                                    <input type="radio" id="boleto" name="metodo_pagamento" value="boleto">
                                    <div class="icon">üßæ</div>
                                    <div>Boleto</div>
                                </label>
                            </div>
                        </div>

                        <div class="form-section" id="cartao-dados">
                            <h4>üí≥ Dados do Cart√£o</h4>
                            
                            {% if cartoes %}
                                <div class="form-group">
                                    <label>Selecionar Cart√£o Salvo</label>
                                    <div class="saved-cards">
                                        <label class="card-option" for="novo_cartao">
                                            <input type="radio" id="novo_cartao" name="cartao_salvo" value="" checked>
                                            <div class="card-info">
                                                <div class="card-number">‚ûï Usar novo cart√£o</div>
                                                <div class="card-name">Digite os dados abaixo</div>
                                            </div>
                                        </label>
                                        {% for cartao in cartoes %}
                                            <label class="card-option" for="cartao_{{ cartao.id_cartao }}">
                                                <input type="radio" id="cartao_{{ cartao.id_cartao }}" 
                                                       name="cartao_salvo" value="{{ cartao.id_cartao }}">
                                                <div class="card-info">
                                                    <div class="card-number">
                                                        {{ cartao.bandeira }} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ cartao.ultimos_4_digitos }}
                                                        {% if cartao.principal %}
                                                            <span class="principal-badge">‚≠ê PRINCIPAL</span>
                                                        {% endif %}
                                                    </div>
                                                    <div class="card-name">{{ cartao.nome_titular }}</div>
                                                    <div class="card-details">{{ cartao.apelido }} ‚Ä¢ {{ cartao.mes_vencimento }}/{{ cartao.ano_vencimento }}</div>
                                                </div>
                                            </label>
                                        {% endfor %}
                                    </div>
                                    <div class="manage-cards">
                                        <a href="/fornecedor/planos/cartoes?id_fornecedor={{ id_fornecedor }}" class="btn-link">üí≥ Gerenciar Cart√µes</a>
                                    </div>
                                </div>
                            {% endif %}
                            
                            <div id="new-card-fields" {% if cartoes %}style="display: none;"{% endif %}>
                                <div class="form-group">
                                    <label for="numero_cartao">N√∫mero do Cart√£o <span class="required">*</span></label>
                                    <input type="text" id="numero_cartao" name="numero_cartao" 
                                           placeholder="0000 0000 0000 0000" maxlength="19">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="validade">Validade <span class="required">*</span></label>
                                        <input type="text" id="validade" name="validade" 
                                               placeholder="MM/AA" maxlength="5">
                                    </div>
                                    <div class="form-group">
                                        <label for="cvv">CVV <span class="required">*</span></label>
                                        <input type="text" id="cvv" name="cvv" 
                                               placeholder="000" maxlength="4">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="nome_cartao">Nome no Cart√£o <span class="required">*</span></label>
                                    <input type="text" id="nome_cartao" name="nome_cartao" 
                                           placeholder="Nome como impresso no cart√£o">
                                </div>
                                
                                {% if cartoes %}
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="salvar_cartao" name="salvar_cartao" value="true">
                                        <label for="salvar_cartao">üíæ Salvar este cart√£o para pagamentos futuros</label>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="security-info">
                            <p>üîí <strong>Pagamento Seguro:</strong> Este √© um ambiente de teste. 
                            Seus dados n√£o ser√£o processados por gateways reais de pagamento.</p>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                üí∞ Finalizar Pagamento - R$ {{ "%.2f"|format(plano.valor_mensal) }}
                            </button>
                            <a href="/fornecedor/planos/listar" class="btn btn-secondary">
                                ‚Ü©Ô∏è Cancelar
                            </a>
                        </div>
                    </form>
                {% else %}
                    <div class="alert alert-error">
                        <strong>Erro:</strong> Informa√ß√µes do plano n√£o encontradas. 
                        <a href="/fornecedor/planos/listar">Volte aos planos dispon√≠veis</a>.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        // Formata√ß√£o de campos
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d)(\d{4})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('numero_cartao').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(\d)/, '$1 $2');
            value = value.replace(/(\d{4}) (\d{4})(\d)/, '$1 $2 $3');
            value = value.replace(/(\d{4}) (\d{4}) (\d{4})(\d)/, '$1 $2 $3 $4');
            e.target.value = value;
        });

        document.getElementById('validade').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '$1/$2');
            e.target.value = value;
        });

        // Sele√ß√£o de m√©todo de pagamento
        document.querySelectorAll('input[name="metodo_pagamento"]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                document.querySelectorAll('.payment-method').forEach(function(method) {
                    method.classList.remove('selected');
                });
                this.closest('.payment-method').classList.add('selected');
                
                const cartaoDados = document.getElementById('cartao-dados');
                if (this.value === 'cartao') {
                    cartaoDados.style.display = 'block';
                } else {
                    cartaoDados.style.display = 'none';
                }
            });
        });

        // Marcar primeiro m√©todo como selecionado
        document.querySelector('.payment-method').classList.add('selected');
        
        // Controlar exibi√ß√£o dos campos de novo cart√£o
        const cartaoSalvoRadios = document.querySelectorAll('input[name="cartao_salvo"]');
        const newCardFields = document.getElementById('new-card-fields');
        
        cartaoSalvoRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === '') {
                    // Novo cart√£o selecionado
                    newCardFields.style.display = 'block';
                    // Tornar campos obrigat√≥rios
                    document.getElementById('numero_cartao').required = true;
                    document.getElementById('validade').required = true;
                    document.getElementById('cvv').required = true;
                    document.getElementById('nome_cartao').required = true;
                } else {
                    // Cart√£o salvo selecionado
                    newCardFields.style.display = 'none';
                    // Remover obrigatoriedade dos campos
                    document.getElementById('numero_cartao').required = false;
                    document.getElementById('validade').required = false;
                    document.getElementById('cvv').required = false;
                    document.getElementById('nome_cartao').required = false;
                }
            });
        });
    </script>
</body>
</html>
