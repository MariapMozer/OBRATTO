<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if cartao %}Editar{% else %}Adicionar{% endif %} Cart√£o - OBRATTO Fornecedor</title>
    <style>
        /* ...existing code... */
    </style>
</head>
<body>
    <div class="navbar">
        <h1>üè¢ OBRATTO - {% if cartao %}Editar{% else %}Adicionar{% endif %} Cart√£o</h1>
        <div class="nav-links">
            <a href="/fornecedor/planos/listar">üí≥ Planos</a>
            <a href="/publico/pagamento/cartoes?tipo_usuario=fornecedor{% if id_fornecedor %}&id_fornecedor={{ id_fornecedor }}{% elif id_prestador %}&id_prestador={{ id_prestador }}{% elif id_cliente %}&id_cliente={{ id_cliente }}{% endif %}">üí≥ Cart√µes</a>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2>{% if cartao %}‚úèÔ∏è Editar Cart√£o{% else %}‚ûï Adicionar Cart√£o{% endif %}</h2>
                <p>{% if cartao %}Atualize as informa√ß√µes do seu cart√£o{% else %}Cadastre um novo cart√£o para pagamentos futuros{% endif %}</p>
            </div>
            <div class="card-body">
                {% if mensagem %}
                    <div class="alert alert-error">
                        {{ mensagem }}
                    </div>
                {% endif %}
                <div class="card-preview" id="cardPreview">
                    <div class="brand" id="previewBrand">BANDEIRA</div>
                    <div class="number" id="previewNumber">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                    <div class="details">
                        <div class="name" id="previewName">NOME DO TITULAR</div>
                        <div class="validity">
                            <div style="font-size: 0.7rem;">V√ÅLIDO AT√â</div>
                            <div id="previewValidity">MM/AA</div>
                        </div>
                    </div>
                </div>
                <form method="post" action="{% if cartao %}/publico/pagamento/cartoes/editar/{{ cartao.id_cartao }}{% else %}/publico/pagamento/cartoes/adicionar{% endif %}">
                    <input type="hidden" name="id_fornecedor" value="{{ id_fornecedor or 1 }}">
                    {% if not cartao %}
                        <div class="form-group">
                            <label for="numero_cartao">N√∫mero do Cart√£o <span class="required">*</span></label>
                            <input type="text" id="numero_cartao" name="numero_cartao" required 
                                   placeholder="0000 0000 0000 0000" maxlength="19">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mes_vencimento">M√™s de Vencimento <span class="required">*</span></label>
                                <select id="mes_vencimento" name="mes_vencimento" required>
                                    <option value="">Selecione...</option>
                                    {% for mes in range(1, 13) %}
                                        <option value="{{ '%02d'|format(mes) }}">{{ '%02d'|format(mes) }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="ano_vencimento">Ano de Vencimento <span class="required">*</span></label>
                                <select id="ano_vencimento" name="ano_vencimento" required>
                                    <option value="">Selecione...</option>
                                    {% for ano in range(2024, 2035) %}
                                        <option value="{{ '%02d'|format(ano % 100) }}">{{ ano }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    {% else %}
                        <!-- Campos readonly para edi√ß√£o -->
                        <div class="form-group">
                            <label>N√∫mero do Cart√£o</label>
                            <input type="text" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ cartao.ultimos_4_digitos }}" readonly>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Validade</label>
                                <input type="text" value="{{ cartao.mes_vencimento }}/{{ cartao.ano_vencimento }}" readonly>
                            </div>
                            <div class="form-group">
                                <label>Bandeira</label>
                                <input type="text" value="{{ cartao.bandeira }}" readonly>
                            </div>
                        </div>
                    {% endif %}
                    <div class="form-group">
                        <label for="nome_titular">Nome do Titular <span class="required">*</span></label>
                        <input type="text" id="nome_titular" name="nome_titular" required 
                               placeholder="Nome como est√° no cart√£o" 
                               value="{{ cartao.nome_titular if cartao else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="apelido">Apelido do Cart√£o <span class="required">*</span></label>
                        <input type="text" id="apelido" name="apelido" required 
                               placeholder="Ex: Cart√£o Principal, Cart√£o Empresarial" 
                               value="{{ cartao.apelido if cartao else '' }}">
                    </div>
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="principal" name="principal" value="true" 
                                   {% if cartao and cartao.principal %}checked{% endif %}>
                            <label for="principal">Definir como cart√£o principal</label>
                        </div>
                        <small style="color: #666;">O cart√£o principal ser√° usado automaticamente nos pagamentos</small>
                    </div>
                    <div class="security-info">
                        <p>üîí <strong>Seus dados est√£o seguros:</strong> As informa√ß√µes do cart√£o s√£o criptografadas e armazenadas de forma segura.</p>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            {% if cartao %}üíæ Salvar Altera√ß√µes{% else %}‚ûï Adicionar Cart√£o{% endif %}
                        </button>
                        <a href="/publico/pagamento/cartoes?tipo_usuario=fornecedor{% if id_fornecedor %}&id_fornecedor={{ id_fornecedor }}{% elif id_prestador %}&id_prestador={{ id_prestador }}{% elif id_cliente %}&id_cliente={{ id_cliente }}{% endif %}" class="btn btn-secondary">‚Ü©Ô∏è Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        // ...existing code...
    </script>
</body>
</html>