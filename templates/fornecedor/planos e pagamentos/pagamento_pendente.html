<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento Pendente - OBRATTO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pending-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
            padding: 3rem;
            text-align: center;
        }
        
        .pending-icon {
            font-size: 4rem;
            color: #ffc107;
            margin-bottom: 1rem;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .pending-title {
            color: #ffc107;
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .pending-message {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .payment-details {
            background: #fff3cd;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 5px solid #ffc107;
        }
        
        .payment-details h3 {
            color: #856404;
            margin-bottom: 1rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .detail-label {
            font-weight: bold;
        }
        
        .status-info {
            background: #e7f3ff;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 5px solid #007bff;
        }
        
        .status-info h3 {
            color: #007bff;
            margin-bottom: 1rem;
        }
        
        .status-info ul {
            text-align: left;
            color: #666;
            line-height: 1.8;
        }
        
        .status-info li {
            margin-bottom: 0.5rem;
        }
        
        .next-steps {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 5px solid #6c757d;
        }
        
        .next-steps h3 {
            color: #495057;
            margin-bottom: 1rem;
        }
        
        .next-steps ol {
            text-align: left;
            color: #666;
            line-height: 1.8;
            padding-left: 1rem;
        }
        
        .next-steps li {
            margin-bottom: 0.5rem;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
            margin: 0.5rem;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #333;
            box-shadow: 0 4px 15px rgba(255,193,7,0.3);
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,193,7,0.4);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,123,255,0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108,117,125,0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108,117,125,0.4);
        }
        
        .loading-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(45deg, #ffc107, #fd7e14);
            border-radius: 2px;
            animation: loading 3s ease-in-out infinite;
        }
        
        @keyframes loading {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        .auto-refresh {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            color: #0c5460;
            font-size: 0.9rem;
        }
        
        .countdown {
            font-weight: bold;
            color: #007bff;
        }
        
        .help-box {
            background: #e2e3e5;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 5px solid #6c757d;
        }
        
        .help-box h3 {
            color: #495057;
            margin-bottom: 1rem;
        }
        
        .help-box p {
            color: #666;
            line-height: 1.6;
        }
        
        .contact-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="pending-container">
        <div class="pending-icon">‚è≥</div>
        <h1 class="pending-title">Pagamento Pendente</h1>
        <p class="pending-message">
            {{ mensagem or "Seu pagamento est√° sendo processado. Aguarde a confirma√ß√£o que pode levar alguns minutos." }}
        </p>
        
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        
        {% if payment_info %}
        <div class="payment-details">
            <h3>üìã Informa√ß√µes do Pagamento</h3>
            <div class="detail-row">
                <span class="detail-label">ID do Pagamento:</span>
                <span>{{ payment_info.id }}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Status:</span>
                <span>{{ payment_info.status }}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Valor:</span>
                <span>R$ {{ "%.2f"|format(payment_info.transaction_amount) }}</span>
            </div>
            {% if payment_info.payment_method_id %}
            <div class="detail-row">
                <span class="detail-label">M√©todo:</span>
                <span>{{ payment_info.payment_method_id }}</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <div class="status-info">
            <h3>üìä Poss√≠veis Status Pendentes</h3>
            <ul>
                <li>üè¶ <strong>in_process:</strong> Pagamento sendo processado pelo banco</li>
                <li>‚è∞ <strong>pending:</strong> Aguardando a√ß√£o do pagador</li>
                <li>‚úÖ <strong>authorized:</strong> Pagamento autorizado, processando</li>
                <li>üîç <strong>in_mediation:</strong> Em processo de media√ß√£o</li>
                <li>üìã <strong>charged_back:</strong> Estornado, sendo revisado</li>
            </ul>
        </div>
        
        <div class="next-steps">
            <h3>üìù Pr√≥ximos Passos</h3>
            <ol>
                <li>üïê Aguarde a confirma√ß√£o (pode levar at√© 2 horas)</li>
                <li>üìß Voc√™ receber√° um email quando o status mudar</li>
                <li>üîÑ Esta p√°gina ser√° atualizada automaticamente</li>
                <li>üí≥ Se aprovado, seu plano ser√° ativado imediatamente</li>
                <li>‚ùå Se rejeitado, nenhum valor ser√° cobrado</li>
            </ol>
        </div>
        
        <div class="auto-refresh">
            üîÑ Esta p√°gina ser√° atualizada automaticamente em <span class="countdown" id="countdown">60</span> segundos
        </div>
        
        <div style="margin: 2rem 0;">
            <button onclick="checkPaymentStatus()" class="btn btn-warning">
                üîç Verificar Status Agora
            </button>
            <a href="/fornecedor/planos/listar" class="btn btn-primary">
                üìã Ver Meus Planos
            </a>
            <a href="/fornecedor" class="btn btn-secondary">
                üè† Voltar ao Painel
            </a>
        </div>
        
        <div class="help-box">
            <h3>‚ùì D√∫vidas?</h3>
            <p>
                Se o pagamento n√£o for processado em at√© 24 horas, entre em contato conosco.
                Nossa equipe ir√° verificar o status junto ao processador de pagamentos.
            </p>
            <div class="contact-info">
                üìß Email: suporte@obratto.com<br>
                üìû Telefone: (11) 1234-5678<br>
                üí¨ WhatsApp: (11) 98765-4321
            </div>
        </div>
        
        <div style="margin-top: 2rem; font-size: 0.9rem; color: #888;">
            <p>
                ‚ÑπÔ∏è N√£o feche esta p√°gina. O status ser√° atualizado automaticamente quando houver mudan√ßas.
            </p>
        </div>
    </div>

    <!-- Dados do servidor para JavaScript -->
    <div id="paymentData" style="display: none;" 
         data-payment-id="{% if payment_info and payment_info.id %}{{ payment_info.id }}{% endif %}"
         data-has-payment="{% if payment_info and payment_info.id %}true{% else %}false{% endif %}">
    </div>

    <script>
        // Obter configura√ß√µes do elemento HTML
        const paymentDataElement = document.getElementById('paymentData');
        const paymentConfig = {
            paymentId: paymentDataElement.dataset.paymentId || null,
            hasPaymentInfo: paymentDataElement.dataset.hasPayment === 'true'
        };
        
        let countdownValue = 60;
        const countdownElement = document.getElementById('countdown');
        
        // Countdown para refresh autom√°tico
        const countdownInterval = setInterval(() => {
            countdownValue--;
            countdownElement.textContent = countdownValue;
            
            if (countdownValue <= 0) {
                clearInterval(countdownInterval);
                window.location.reload();
            }
        }, 1000);
        
        // Fun√ß√£o para verificar status manualmente
        async function checkPaymentStatus() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'üîÑ Verificando...';
            button.disabled = true;
            
            try {
                if (paymentConfig.hasPaymentInfo && paymentConfig.paymentId) {
                    const response = await fetch(`/fornecedor/planos/status_pagamento/${paymentConfig.paymentId}`);
                    const data = await response.json();
                    
                    if (data.status === 'approved') {
                        window.location.href = `/fornecedor/planos/pagamento_sucesso?payment_id=${paymentConfig.paymentId}`;
                    } else if (data.status === 'rejected') {
                        window.location.href = `/fornecedor/planos/pagamento_erro?payment_id=${paymentConfig.paymentId}`;
                    } else {
                        // Ainda pendente, reload da p√°gina
                        window.location.reload();
                    }
                } else {
                    // Se n√£o temos ID do pagamento, apenas reload
                    window.location.reload();
                }
            } catch (error) {
                console.error('Erro ao verificar status:', error);
                button.textContent = '‚ùå Erro na verifica√ß√£o';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 3000);
            }
        }
        
        // Auto-check a cada 30 segundos (em background)
        setInterval(async () => {
            try {
                if (paymentConfig.hasPaymentInfo && paymentConfig.paymentId) {
                    const response = await fetch(`/fornecedor/planos/status_pagamento/${paymentConfig.paymentId}`);
                    const data = await response.json();
                    
                    if (data.status !== 'pending' && data.status !== 'in_process' && data.status !== 'authorized') {
                        window.location.reload();
                    }
                }
            } catch (error) {
                console.error('Erro no auto-check:', error);
            }
        }, 30000);
    </script>
</body>
</html>
