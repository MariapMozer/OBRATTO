{% extends "fornecedor/base.html" %}

{#
    Template: Home Fornecedor
    Descrição: Página inicial do fornecedor com produtos e promoções
    Estende: fornecedor/base.html
#}

{% from 'components/product_card.html' import product_card %}

{% block css %}
<link rel="stylesheet" href="/static/css/home_fornecedor.css">
{% endblock %}

{% block fornecedor_titulo %}Home - Fornecedor{% endblock %}

{% block sidebar_active %}home{% endblock %}

{% block fornecedor_conteudo %}
<div class="container-fluid px-4">
    <!-- Seção de Promoções -->
    <section class="promotions-section mb-5">
        <div class="section-header d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title">PROMOÇÕES</h2>
            <a href="/fornecedor/promocao/listar" class="view-all-btn">
                Ver todos <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>

        {% if produtos %}
        <div id="promotionsCarousel" class="carousel slide" data-bs-ride="false">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div class="row g-4">
                        {% for produto in produtos[:3] %}
                        <div class="col-lg-4 col-md-6">
                            {{ product_card(
                                produto=produto,
                                show_actions=True,
                                edit_url='/fornecedor/produtos/atualizar/' ~ produto.id,
                                delete_handler='confirmDeleteProduct',
                                card_class='h-100'
                            ) }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {% if produtos|length > 3 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#promotionsCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#promotionsCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Próximo</span>
            </button>
            {% endif %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Nenhuma promoção ativa no momento.
        </div>
        {% endif %}
    </section>

    <!-- Seção de Produtos -->
    <section class="products-section mb-5">
        <div class="section-header d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title">PRODUTOS</h2>
            <a href="/fornecedor/produtos/listar" class="view-all-btn">
                Ver todos <i class="bi bi-arrow-right ms-1"></i>
            </a>
        </div>

        {% if produtos %}
        <div id="productsCarousel" class="carousel slide" data-bs-ride="false">
            <div class="carousel-inner">
                {% for i in range(0, produtos|length, 3) %}
                <div class="carousel-item {% if i == 0 %}active{% endif %}">
                    <div class="row g-4">
                        {% for produto in produtos[i:i+3] %}
                        <div class="col-lg-4 col-md-6">
                            {{ product_card(
                                produto=produto,
                                show_actions=True,
                                edit_url='/fornecedor/produtos/atualizar/' ~ produto.id,
                                delete_handler='confirmDeleteProduct',
                                card_class='h-100'
                            ) }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if produtos|length > 3 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#productsCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#productsCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Próximo</span>
            </button>
            {% endif %}
        </div>
        {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Você ainda não cadastrou nenhum produto.
            <a href="/fornecedor/produtos/inserir" class="alert-link">Cadastre seu primeiro produto</a>.
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}

{% block fornecedor_scripts %}
<script src="/static/js/home_fornecedor.js"></script>

<script>
function confirmDeleteProduct(produtoId, produtoNome) {
    if (confirm(`Tem certeza que deseja excluir o produto "${produtoNome}"?`)) {
        window.location.href = `/fornecedor/produtos/excluir/${produtoId}`;
    }
}
</script>
{% endblock %}
